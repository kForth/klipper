# This file contains pin mappings for the CreatBot F430 (Not BOARD_VERSION_GT_V95).
# To use this config, the firmware should be compiled for the AVR
# atmega2560.

# See docs/Config_Reference.md for a description of parameters.

[mcu]
serial: /dev/ttyACM0

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 2000
max_z_velocity: 20
max_z_accel: 100

[stepper_x]
step_pin: PH0
dir_pin: !PH1
enable_pin: !PL1
microsteps: 16
full_steps_per_rotation: 200
# steps_per_mm: 78.7402
rotation_distance: 40.6340
endstop_pin: ^PC0
position_endstop: 0
position_max: 400

[stepper_y]
step_pin: PF0
dir_pin: PL2
enable_pin: !PF1
microsteps: 16
full_steps_per_rotation: 200
# steps_per_mm: 131.2336
rotation_distance: 24.3840
endstop_pin: ^PC2
position_endstop: 0
position_max: 300

[stepper_z]
step_pin: PF3
dir_pin: !PF2
enable_pin: !PK0
microsteps: 16
full_steps_per_rotation: 200
# steps_per_mm: 640
rotation_distance: 5
endstop_pin: ^PC4
position_endstop: 0
position_max: 300

[extruder]
step_pin: PA1
dir_pin: PA0
enable_pin: !PA2
microsteps: 16
full_steps_per_rotation: 200
# steps_per_mm: 130
rotation_distance: 24.6154
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PE4
sensor_type: AD595
sensor_pin: PK7
control: pid
pid_Kp: 12.9
pid_Ki: 0.76
pid_Kd: 55
min_temp: 0
max_temp: 265
max_extrude_only_velocity: 40
max_extrude_only_accel: 3000

[extruder1]
step_pin: PA4
dir_pin: PA3
enable_pin: !PA5
microsteps: 16
full_steps_per_rotation: 200
# steps_per_mm: 130
rotation_distance: 24.6154
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PE5
sensor_type: AD595
sensor_pin: PK6
control: pid
pid_Kp: 12.9
pid_Ki: 0.76
pid_Kd: 55
min_temp: 0
max_temp: 415
max_extrude_only_velocity: 40
max_extrude_only_accel: 3000

# [extruder2]
# step_pin: PA7
# dir_pin: PA6
# enable_pin: !PG2
# microsteps: 16
# full_steps_per_rotation: 200
# # steps_per_mm: 130
# rotation_distance: 24.6154
# nozzle_diameter: 0.400
# filament_diameter: 1.750
# heater_pin: PH3
# sensor_type: AD595
# sensor_pin: PK5
# control: pid
# pid_Kp: 12.9
# pid_Ki: 0.76
# pid_Kd: 55
# min_temp: 0
# max_temp: 415
# max_extrude_only_velocity: 40
# max_extrude_only_accel: 3000

[heater_bed]
heater_pin: PH6
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PK3
control: pid
pid_Kp: 345.78
pid_Ki: 14.59
pid_Kd: 2047.99
min_temp: 0
max_temp: 120

[heater_generic heater_chamber]
gcode_id: chamber
heater_pin: PH3
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PK4
control: watermark
min_temp: 0
max_temp: 75

[fan]
pin: PH4

[heater_fan extruder_fan]
pin: PH5
heater: extruder, extruder1
heater_temp: 50.0

[heater_fan chamber_fan]
pin: PB4
heater: heater_chamber
heater_temp: 75.0

[bltouch]
sensor_pin: PC5
control_pin: PE3
x_offset: 36
z_offset: 72
z_offset: 1
#speed: 5
lift_speed: 20
#samples: 1

[safe_z_home]
home_xy_position: 50, 50
speed: 100
z_hop: 15
z_hop_speed: 20
#move_to_previous: False
#   When set to True, the X and Y axes are reset to their previous
#   positions after Z axis homing. The default is False.

[bed_mesh]
speed: 100
horizontal_move_z: 7
mesh_min: 20, 20
mesh_max: 380, 280
probe_count: 6, 4

[filament_switch_sensor runout_e0]
switch_pin: PC1

[filament_switch_sensor runout_e1]
switch_pin: PC3

[output_pin beeper]
pin: PL5
pwm: True
value: 0
shutdown_value: 0
cycle_time: 0.001

[output_pin suicide]
pin: PG1
value: 1
shutdown_value: 0
cycle_time: 0.001

[gcode_button off_button]
pin: PG0
press_gcode:
  M117 Powering Off
  TURN_OFF_HEATERS
  SET_FAN_SPEED FAN=extruder_fan SPEED=1.0
  TEMPERATURE_WAIT SENSOR=extruder MINIMUM=50
  TEMPERATURE_WAIT SENSOR=extruder1 MINIMUM=5
  SET_PIN pin=suicide VALUE=0

[gcode_button accident_detect]
pin: PH0
press_gcode:
  M117 Power Loss Detected!
  SAVE_GCODE_STATE NAME=power_loss
  M91
  G1 Z10 F120
  PAUSE

## Unused Pins from Marlin Config
#define LED_PIN             13 //PB7
#define LCD_PINS_RS         19 //PD2
#define LCD_PINS_ENABLE     42 //PL7
#define LCD_PINS_D4         18 //PD3
#define LCD_PINS_D5         38 //PD7
#define LCD_PINS_D6         41 //PG0
#define LCD_PINS_D7         40 //PG1
#define BTN_EN1             11 //PB5
#define BTN_EN2             12 //PB6
#define BTN_ENC             43 //PL6
#define SDSS                53 //PB0
#define SD_DETECT_PIN       49 //PL0
#define USB_SS		          53 //PB0
#define USB_MOSI	          51 //PB2
#define USB_MISO	          50 //PB3
#define USB_SCK		          52 //PB1
#define USB_INT		          49 //PL0

## GCode Macros
[gcode_macro M141]
gcode:
  {% set s={params.S|float} %}
  SET_HEATER_TEMPERATURE HEATER=heater_chamber TARGET={s}
description: Set chamber temperature

[gcode_macro M191]
gcode:
  {% set s={params.S|float} %}
  SET_HEATER_TEMPERATURE HEATER=heater_chamber TARGET={s}
  {% if s != 0 %}
    TEMPERATURE_WAIT HEATER=heater_chamber MINIMUM={s} MAXIMIM={s+1}
  {% endif %}
description: Set chamber temperature and wait